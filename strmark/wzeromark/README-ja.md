# マークの生成方法について

Watermark Zero API（以降、`W-ZeroAPI`）では、ユーザから入力される文字列（**ソース**）から、ビット列（[]bool）の**マーク**を生成する手順について、広くアルゴリズムを公開して運用する。

## 概要

W-ZeroAPIはソースから**非可逆的変換によりマークを生成**する。つまりソースは画像に直接埋め込まない。
ソースは外部リソースに保存され、タイムスタンプとノンスによって特定される構成となっている。
マークは下のような**664b (83B)**の固定長構成となっている。

| 名称 | 長さ | 目的 | 詳細 |
| :-- | --: | :--| :-- |
| バージョン | 1B | マークの構成管理のため |  |
| タイムスタンプ | 6B | マーク生成日時登録のため | Unixミリ秒 |
| ノンス | 2B | 外部リソースへのソース特定のため | 乱数 |
| 組織コード | 2B | 組織識別のため | 通常4桁のHexで表現される組織ごとに固有な値 |
| ハッシュ | 8B | ソース保存のため | 日時、ソースから決定論的に導かれるHMAC-SHA256ハッシュ値の先頭8B |
| 署名 | 64B | マークの改ざん防止のため | 署名以下のEd25519 |


### 秘密値

マーク作成に必要な秘密値（シークレット）は以下の通り。

| 名称 | 長さ | 単位 | 対象 | 詳細 |
| :-- | --: | :--| :-- | :-- |
| マスタキー | 32B | システム | ハッシュ | ハッシュのペッパー生成のため |
| 組織ソルト | 32B | 組織 | ハッシュ | ハッシュデータとなるソースに加えるソルト |
| 組織マスタシード | 32B | 組織 | 署名 | Ed25519のシード生成のため |

## 構成詳細

### バージョン

### タイムスタンプ

### ノンス（乱数）

### 組織コード

### ハッシュ

### 署名